#:kivy 1.7.2
#:import Colors Config.WIDGET_COLORS
#:import Sizes Config.WIDGET_SIZES


<HorizontalFadeBar@BoxLayout>
    value: None
    secValue: None

    FloatLayout:
        canvas.before:
            Color:
                rgba: Colors.SCREEN_BAR_COLOR_BACK

            Rectangle:
                pos: self.pos
                size: self.size

        canvas:
            Color:
                rgba: Colors.SCREEN_BAR_COLOR_FIRST
            Rectangle:
                pos: self.pos[0], self.pos[1] + (self.size[1] / 2)
                size: (self.size[0] * root.value if root.value else 1.0, self.size[1] / 2)

        canvas.after:
            Color:
                rgba: Colors.SCREEN_BAR_COLOR_SECOND

            Rectangle:
                pos: self.pos
                size: (self.size[0] * root.secValue if root.secValue else 1.0, self.size[1] / 2)



<ScenePositionBars@BoxLayout>
    orientation: 'vertical'
    spacing: 5

    sceneTime: 0.0
    fadeTime: 0.0
    currentTime: 0.0

    HorizontalFadeBar:
        value: float(root.currentTime) / float(root.sceneTime) if root.sceneTime > 0.0 else 0.0
        secValue:  float(root.fadeTime) / float(root.sceneTime) if root.sceneTime > 0.0 else 0.0


<MiniLabel@BoxLayout>
    label: None
    value: None

    orientation: "vertical"

    Label:
        text: str(root.label) if root.label is not None else "None"
        font_size: self.height / 2
        size_hint: 1.0, 0.3

    Label:
        text: str(root.value) if root.value is not None else "None"
        font_size: self.height / 2
        size_hint: 1.0, 0.7



<SceneMixerScreen@BoxLayout>
    currentTime: 0.0
    sceneTime: 0.0
    fadeTime: 0.0
    sceneNumber: None

    padding: 3

    canvas:
        Color:
            rgba: Colors.WIDGET_GREY_LIGHT

        Rectangle:
            pos: self.pos
            size: self.size

    BoxLayout:
        pos: root.pos
        size: root.size

        orientation: 'horizontal'

        canvas:
            Color:
                rgba: Colors.WIDGET_BPM_SCREEN_COLOR

            Rectangle:
                pos: self.pos
                size: self.size

        BoxLayout:
            padding: 10
            BoxLayout:
                spacing: 5
                size_hint: 0.6, 1
                orientation: "vertical"

                BoxLayout:
                    size_hint: 1, 0.7
                    MiniLabel:
                        label: "CUR TIME"
                        value: root.currentTime
                    MiniLabel:
                        label: "SCN TIME"
                        value: root.sceneTime
                    MiniLabel:
                        label: "FADE TIME"
                        value: root.fadeTime

                ScenePositionBars:
                    currentTime: root.currentTime
                    sceneTime: root.sceneTime
                    fadeTime: root.fadeTime
                    size_hint: 1.0, 0.3

            BoxLayout:
                size_hint: 0.4, 1
                MiniLabel:
                    label: "SCENE NUM"
                    value: root.sceneNumber if root.sceneNumber else "0:0"



<SceneMixer>
    currentTime: 0.0
    sceneTime: 0.0
    fadeTime: 0.0
    sceneNumber: "0:0"

    BoxLayout:
        orientation: 'vertical'
        padding: Sizes.WIDGET_BORDER
        spacing: Sizes.WIDGET_SPACING

        pos: root.pos
        size: root.size

        canvas:
            Color:
                rgba: Colors.WIDGET_BACKGROUND_DARK
            Rectangle:
                pos: self.pos
                size: self.size

        WidgetHeader:
            title: "Scene controller"
            size_hint_x: 1
            size_hint_y: None
            height: Sizes.HEADER_FONT_SIZE

        BoxLayout:
            size: root.size
            pos: root.pos

            spacing: 5
            padding: 5
            orientation: "vertical"

            canvas:
                Color:
                    rgba: Colors.WIDGET_BACKGROUND_LIGHT
                Rectangle:
                    pos: self.pos
                    size: self.size

            BoxLayout:
                spacing: 5
                size_hint: 1, 0.6
                # Display part of the widget
                SceneMixerScreen:
                    size_hint: 0.9, 1

                    currentTime: root.currentTime
                    sceneTime: root.sceneTime
                    fadeTime: root.fadeTime
                    sceneNumber: root.sceneNumber

                # SIDE BUTTONS
                BoxLayout:
                    padding: 0
                    spacing: 5
                    size_hint: 0.1, 1.0
                    orientation: "vertical"
                    LightButton:
                        text: "ADD"
                        on_press: root.addScene()
                    LightButton:
                        text: "INS B"
                        on_press: root.insertSceneBefore()

                    LightButton:
                        text: "INS A"
                        on_press: root.insertSceneAfter()

                    LightButton:
                        text: "DEL"
                        on_press: root.deleteScene()

            # CONTROL BUTTONS
            BoxLayout:
                padding: 0
                spacing: 5
                size_hint: 1, 0.2

                LightButton:
                    text: "START"
                    on_press: root.gotoStartOfShow()
                LightButton:
                    text: "END"
                    on_press: root.gotoEndOfShow()
                LightButton:
                    text: "PREV"
                    on_press: root.gotoPrevScene()
                LightButton:
                    text: "NEXT"
                    on_press: root.gotoNextScene()
                LightButton:
                    text: "PLAY"
                    on_press: root.startStopPlayback()

            # CONTROLLER OPTIONS
            BoxLayout:
                spacing: 5
                size_hint: 1, 0.2
                GridLayout:
                    cols: 2

                    BoxLayout:
                        CheckBox:
                            size_hint: 0.15, 1
                            size: self.size
                            on_active: root.toggleGlobalSceneTime(args[1])
                            valign: "middle"
                        Label:
                            size_hint: 0.85, 1
                            text: "SET GLOBAL SCENE TIME"
                            text_size: self.size
                            font_size: "12dp"
                            valign: "middle"

                    BoxLayout:
                        CheckBox:
                            size_hint: 0.15, 1
                            size: self.size
                            on_active: root.toggleSyncSceneAndFadeTime(args[1])
                            valign: "middle"
                        Label:
                            size_hint: 0.85, 1
                            text: "SYNC SCENE AND FADE TIME"
                            text_size: self.size
                            font_size: "12dp"
                            valign: "middle"

                    BoxLayout:
                        CheckBox:
                            size_hint: 0.15, 1
                            size: self.size
                            on_active: root.toggleGlobalFadeTime(args[1])
                            valign: "middle"
                        Label:
                            size_hint: 0.85, 1
                            text: "SET GLOBAL FADE TIME"
                            text_size: self.size
                            font_size: "12dp"
                            valign: "middle"



                    BoxLayout:
                        CheckBox:
                            size_hint: 0.15, 1
                            size: self.size
                            active: True
                            on_active: root.toggleLoopScenes(args[1])
                            valign: "middle"
                        Label:
                            size_hint: 0.85, 1
                            text: "LOOP AFTER END"
                            text_size: self.size
                            font_size: "12dp"
                            valign: "middle"
